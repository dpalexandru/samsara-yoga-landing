---
const links = [
  { name: 'Home', href: '/' },
  { name: 'Chi sono', href: '/chisono' },
  { name: 'Corsi e orari', href: '/orarielezioni' },
  { name: 'Contatti', href: '/contattami' },
  { name: 'Instagram', href: 'https://www.instagram.com/fran.ashtanga/', external: true, icon: 'mdi:instagram' },
  { name: 'Facebook', href: 'https://www.facebook.com/profile.php?id=100085513893561&rdid=hGBsV8cgG43uAwfu&share_url=https%3A%2F%2Fwww.facebook.com%2Fshare%2F16JfVKuakV%2F#', external: true, icon: 'mdi:facebook' },
];

import '../styles/global.css';
---

<nav id="site-nav" class="bg-indigo-900 shadow-md fixed top-0 w-full z-50" data-open="false">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">
      <!-- Logo + Titolo -->
      <a href="/" class="flex items-center gap-2">
        <img
          src="/logo.png"
          alt="Logo La Ruota Del Samsara"
          class="h-10 w-10 md:h-12 md:w-12 object-contain"
        />
        <link
          href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,600&display=swap"
          rel="stylesheet"
        />
        <span
          class="title-logo text-white font-[Playfair_Display] italic text-[1.6rem] md:text-[1.8rem] tracking-[0.03em]"
        >
          LaRuotadelSamsara
        </span>
      </a>

      <!-- Menu desktop -->
      <div class="hidden md:flex items-center gap-6">
        {links.map((link) => (
          <a
            href={link.href}
            class="relative text-white/90 hover:text-yellow-300 transition flex items-center gap-2 group"
            target={link.external ? '_blank' : '_self'}
            rel={link.external ? 'noopener noreferrer' : undefined}
          >
            {link.icon && (
              <iconify-icon icon={link.icon} width="20" class="text-yellow-300"></iconify-icon>
            )}
            <span>{link.name}</span>
            <!-- underline animata desktop -->
            <span
              class="pointer-events-none absolute left-0 -bottom-1 h-[2px] w-0 bg-yellow-300 transition-all duration-300 group-hover:w-full"
            ></span>
          </a>
        ))}
      </div>

      <!-- Bottone hamburger mobile (morph in X via CSS) -->
      <button
        id="menu-toggle"
        class="md:hidden relative h-10 w-10 inline-grid place-items-center"
        aria-controls="mobile-drawer"
        aria-expanded="false"
        aria-label="Apri menu"
      >
        <span class="sr-only">Apri menu</span>
        <span
          class="hamburger-line line-1 block h-[3px] w-7 bg-white rounded-full transition-all duration-300 origin-center"
        ></span>
        <span
          class="hamburger-line line-2 block h-[3px] w-7 bg-white rounded-full transition-all duration-300 origin-center mt-[4px]"
        ></span>
        <span
          class="hamburger-line line-3 block h-[3px] w-7 bg-white rounded-full transition-all duration-300 origin-center mt-[4px]"
        ></span>
      </button>
    </div>
  </div>

  <!-- Overlay -->
  <div
    id="menu-overlay"
    class="fixed inset-0 bg-black/50 opacity-0 pointer-events-none transition-opacity duration-300 z-40 md:hidden"
  ></div>

  <!-- Drawer mobile da destra -->
  <aside
    id="mobile-drawer"
    class="fixed right-0 top-0 h-screen w-80 max-w-[85vw] md:hidden
           bg-indigo-900 bg-[url('/logo.png')] bg-no-repeat bg-center bg-contain bg-blend-overlay
           z-50 shadow-xl transition-transform duration-300 will-change-transform
           pt-20 pb-10 px-6 flex flex-col gap-2"
    role="dialog"
    aria-modal="true"
    aria-labelledby="mobile-menu-title"
  >
    <h2 id="mobile-menu-title" class="sr-only">Menu</h2>

    <!-- Header del drawer con bottone chiudi -->
    <div class="absolute top-4 right-4">
      <button
        id="drawer-close"
        class="inline-flex h-10 w-10 items-center justify-center rounded-full
               text-white/90 hover:text-yellow-300 hover:bg-white/10 focus:outline-none
               focus:ring-2 focus:ring-yellow-300 focus:ring-offset-2 focus:ring-offset-indigo-900
               transition"
        aria-label="Chiudi menu"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <!-- Link mobile con stagger -->
    {links.map((link, i) => (
      <a
        href={link.href}
        class="mobile-link text-white/95 hover:text-yellow-300 flex items-center gap-2 py-2"
        style={`--delay:${i * 70 + 80}ms`}
        target={link.external ? '_blank' : '_self'}
        rel={link.external ? 'noopener noreferrer' : undefined}
      >
        {link.icon && (
          <iconify-icon icon={link.icon} width="20" class="text-yellow-300"></iconify-icon>
        )}
        <span class="text-lg">{link.name}</span>
      </a>
    ))}
  </aside>

  <style is:global>
    /* NAV MODERNO – ANIMAZIONI BASATE SU data-open */

    /* Hamburger → X */
    #site-nav .hamburger-line {
      border-radius: 9999px;
    }

    #site-nav[data-open='true'] .line-1 {
      transform: translateY(7px) rotate(45deg);
    }

    #site-nav[data-open='true'] .line-2 {
      opacity: 0;
      transform: scaleX(0.4);
    }

    #site-nav[data-open='true'] .line-3 {
      transform: translateY(-7px) rotate(-45deg);
    }

    /* Overlay fade + blur */
    #site-nav[data-open='true'] #menu-overlay {
      opacity: 1;
      pointer-events: auto;
      backdrop-filter: blur(2px);
    }

    /* Stato iniziale del drawer (nascosto a destra) */
    #mobile-drawer {
      transform: translateX(100%);
    }

    /* Link mobile: animazione di ingresso con stagger */
    .mobile-link {
      opacity: 0;
      transform: translateY(4px);
    }

    @keyframes navLinkIn {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    #site-nav[data-open='true'] .mobile-link {
      animation: navLinkIn 0.35s ease-out forwards;
      animation-delay: var(--delay, 100ms);
    }

    #site-nav[data-open='false'] .mobile-link {
      opacity: 0;
      transform: translateY(4px);
      animation: none;
    }

    /* Blocca scroll quando menu aperto */
    html.nav-locked,
    body.nav-locked {
      overflow: hidden;
    }
  </style>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const nav = document.getElementById('site-nav');
      const btn = document.getElementById('menu-toggle');
      const drawer = document.getElementById('mobile-drawer');
      const overlay = document.getElementById('menu-overlay');
      const closeBtn = document.getElementById('drawer-close');

      if (!nav || !btn || !drawer || !overlay) return;

      let open = false;

      const setOpen = (v) => {
        open = v;

        // stato data-open (usato da CSS per hamburger, overlay, link)
        nav.dataset.open = v ? 'true' : 'false';

        // aria
        btn.setAttribute('aria-expanded', String(v));
        btn.setAttribute('aria-label', v ? 'Chiudi menu' : 'Apri menu');

        // posizione drawer: QUI lo forziamo a comparire
        drawer.style.transform = v ? 'translateX(0)' : 'translateX(100%)';

        // blocca scroll sotto
        document.documentElement.classList.toggle('nav-locked', v);
        document.body.classList.toggle('nav-locked', v);

        // focus base
        if (v) {
          const firstLink = drawer.querySelector('a');
          if (firstLink) {
            setTimeout(() => firstLink.focus(), 150);
          }
        } else {
          if (typeof btn.focus === 'function') btn.focus();
        }
      };

      const toggle = () => setOpen(!open);

      btn.addEventListener('click', toggle);
      overlay.addEventListener('click', () => setOpen(false));
      if (closeBtn) closeBtn.addEventListener('click', () => setOpen(false));

      // ESC per chiudere
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && open) setOpen(false);
      });

      // clic su link del drawer → chiudi
      drawer.addEventListener('click', (e) => {
        const t = e.target;
        if (t && t.closest && t.closest('a')) {
          setOpen(false);
        }
      });
    });
  </script>
</nav>
